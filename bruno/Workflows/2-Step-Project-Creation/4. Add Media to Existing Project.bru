meta {
  name: 4. Add Media to Existing Project
  type: http
  seq: 5
}

post {
  url: {{base_url}}/projects/{{two_step_project_id}}/media
  body: json
  auth: inherit
}

body:json {
  {
    "mediaId": "{{uploaded_media_id_2}}"
  }
}

tests {
  test("should add media successfully", function() {
    expect(res.getStatus()).to.equal(201);
    expect(res.getBody()).to.have.property('media');
    expect(res.getBody().media).to.be.an('array');
  });
  
  test("should have media with correct properties", function() {
    const media = res.getBody().media;
    expect(media.length).to.be.greaterThan(1);
    
    // Check that the new media was added
    const addedMedia = media.find(m => m.id === bru.getEnvVar('uploaded_media_id_2'));
    expect(addedMedia).to.exist;
    expect(addedMedia.alt).to.equal('Secondary project screenshot');
  });
}

docs {
  # Step 4: Add Media to Existing Project
  
  **Extension de projet** - Ajout a posteriori
  
  ## ğŸ¯ Objectif
  Ajouter un mÃ©dia existant Ã  un projet dÃ©jÃ  crÃ©Ã© pour dÃ©montrer la flexibilitÃ© post-crÃ©ation.
  
  ## ğŸ“¥ PrÃ©requis
  - âœ… Projet existant (variable `two_step_project_id`)
  - âœ… MÃ©dia existant (variable `uploaded_media_id_2`)
  - âœ… ExÃ©cuter les Ã©tapes 1, 1b et 2 avant ce test
  
  ## ğŸ“¤ Ce que fait ce test
  - âœ… Ajoute un mÃ©dia existant Ã  un projet existant
  - âœ… Valide que le mÃ©dia n'est pas dÃ©jÃ  associÃ©
  - âœ… Met Ã  jour les associations projet-mÃ©dia
  - âœ… Retourne le projet mis Ã  jour
  
  ## ğŸ—‚ï¸ Payload simple
  ```json
  {
    "mediaId": "id-du-media-existant"
  }
  ```
  
  ## âœ… Cas d'usage
  - **Enrichissement**: Ajouter des mÃ©dias aprÃ¨s crÃ©ation
  - **Ã‰volution**: Projets qui s'Ã©toffent dans le temps
  - **FlexibilitÃ©**: Gestion granulaire des associations
  - **Maintenance**: Ajouts/retraits dynamiques
  
  **Note**: Le mÃ©dia doit exister et ne pas Ãªtre dÃ©jÃ  associÃ© au projet.
}