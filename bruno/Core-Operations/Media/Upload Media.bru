meta {
  name: Upload media file (Standalone)
  type: http
  seq: 1
}

post {
  url: {{base_url}}/media/upload
  body: multipartForm
  auth: bearer
}

auth:bearer {
  token: {{jwt_token}}
}

body:multipart-form {
  file: @file(test-image.jpg)
  alt: Test image for portfolio
  folder: test-uploads
}

tests {
  test("should upload media successfully with auth", function() {
    expect(res.status).to.be.oneOf([201, 401]);
    
    if (res.status === 201) {
      expect(res.body).to.have.property('id');
      expect(res.body).to.have.property('url');
      expect(res.body.type).to.be.oneOf(['PHOTO', 'VIDEO', 'PDF', 'DOCUMENT']);
      expect(res.body.originalName).to.exist;
      expect(res.body.size).to.be.a('number');
    } else {
      console.log("‚ö†Ô∏è Authentication failed - Update jwt_token in environment");
    }
  });
}

docs {
  # Upload Media (Standalone - S3) - üîê REQUIRES AUTHENTICATION
  
  ‚ö†Ô∏è **AUTHENTICATION REQUIRED**: This endpoint now requires a valid JWT token from AWS Cognito.
  
  ‚ö° **WORKFLOW**: Upload direct de m√©dia sur S3 sans association √† un projet.
  
  ## Authentication Setup:
  1. Configure `jwt_token` variable in Bruno environment
  2. Get JWT token from AWS Cognito (see Authentication folder)
  3. Token is automatically added as Bearer token
  
  ## Cas d'usage:
  - ‚úÖ M√©dia standalone (pas li√© √† un projet)
  - ‚úÖ Upload en avance pour usage ult√©rieur
  - ‚úÖ Gestion s√©par√©e des m√©dias
  - ‚úÖ Stockage S3 avec toutes les fonctionnalit√©s
  - üîê **NEW**: S√©curis√© par authentification JWT
  
  ## vs. Workflow Unifi√©:
  - **Cet endpoint**: M√©dia ind√©pendant, non li√© √† un projet (requires auth)
  - **Workflow unifi√©**: M√©dia automatiquement li√© au projet lors de la cr√©ation (requires auth)
  
  ## Fonctionnalit√©s:
  - Stockage S3 s√©curis√©
  - Validation avanc√©e des types
  - M√©tadonn√©es compl√®tes
  - Signed URLs disponibles
  - Stats et gestion CRUD
  - Protection par authentification JWT
  
  **Note**: Remplacez le chemin du fichier par un fichier r√©el.
  **Authentication**: Voir le dossier Authentication pour obtenir un token JWT.
}
